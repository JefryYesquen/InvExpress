-- PostgreSQL Script
 

 
-- TABLA: Rol
CREATE TABLE rol (
    idRol SERIAL PRIMARY KEY,
    nombreRol VARCHAR(50) NOT NULL
);
 
-- TABLA: Usuario
CREATE TABLE usuario (
    idUsuario SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    usuario VARCHAR(50) UNIQUE NOT NULL,
    contrasena VARCHAR(255) NOT NULL,
    idRol INT NOT NULL,
    FOREIGN KEY (idRol) REFERENCES rol (idRol)
);
 
-- TABLA: Cliente
CREATE TABLE cliente (
    idCliente SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    cedula VARCHAR(20) UNIQUE NOT NULL,
    telefono VARCHAR(20)
);
 
-- TABLA: Producto
CREATE TABLE producto (
    idProducto SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    descripcion TEXT,
    precio DECIMAL(10,2) NOT NULL,
    stock INT NOT NULL DEFAULT 0
);
 
-- TABLA: Inventario
CREATE TABLE inventario (
    idInventario SERIAL PRIMARY KEY,
    fechaActualizacion DATE NOT NULL DEFAULT CURRENT_DATE,
    idProducto INT NOT NULL,
    FOREIGN KEY (idProducto) REFERENCES producto (idProducto)
);
 
-- TABLA: Venta
CREATE TABLE venta (
    idVenta SERIAL PRIMARY KEY,
    fecha DATE NOT NULL DEFAULT CURRENT_DATE,
    total DECIMAL(10,2) DEFAULT 0,
    idCliente INT NOT NULL,
    idUsuario INT NOT NULL,
    FOREIGN KEY (idCliente) REFERENCES cliente (idCliente),
F   OREIGN KEY (idUsuario) REFERENCES usuario (idUsuario)
);
 
-- TABLA: DetalleVenta
CREATE TABLE detalle_venta (
    idDetalle SERIAL PRIMARY KEY,
    idVenta INT NOT NULL,
    idProducto INT NOT NULL,
    cantidad INT NOT NULL,
    subtotal DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (idVenta) REFERENCES venta (idVenta),
    FOREIGN KEY (idProducto) REFERENCES producto (idProducto)
);
 
-- TABLA: Reporte
CREATE TABLE reporte (
    idReporte SERIAL PRIMARY KEY,
    tipoReporte VARCHAR(50) NOT NULL,
    fechaGeneracion DATE NOT NULL DEFAULT CURRENT_DATE,
    idUsuario INT NOT NULL,
    FOREIGN KEY (idUsuario) REFERENCES usuario (idUsuario)
);
 
-- DATOS INICIALES
 
-- Roles base
INSERT INTO rol (nombreRol) VALUES ('Administrador'), ('Vendedor'), ('Supervisor');
 
-- Usuario inicial
INSERT INTO usuario (nombre, usuario, contrasena, idRol)
VALUES ('Admin General', 'admin', 'admin123', 1);
 
-- Clientes de ejemplo
INSERT INTO cliente (nombre, cedula, telefono)
VALUES 
('Carlos Pérez', '123456789', '3001112233'),
('Ana Gómez', '987654321', '3012223344');
 
-- Productos iniciales
INSERT INTO producto (nombre, descripcion, precio, stock)
VALUES
('Mouse Logitech M90', 'Mouse óptico USB', 45000, 20),
('Teclado Genius', 'Teclado con cable USB', 60000, 15),
('Monitor LG 24"', 'Monitor LED Full HD', 700000, 5);
 
-- Actualización inventario
INSERT INTO inventario (idProducto) VALUES (1), (2), (3);
 
-- VISTA OPCIONAL: reporte_ventas
CREATE VIEW vista_reporte_ventas AS
SELECT 
    v.idVenta, 
    v.fecha, 
    c.nombre AS cliente, -- Esta es la tabla cliente
    u.nombre AS vendedor, -- Esta es la tabla usuario
    v.total
FROM venta v
JOIN cliente c ON v.idCliente = c.idCliente -- Este es el JOIN con cliente
JOIN usuario u ON v.idUsuario = u.idUsuario; -- Este es el JOIN con usuario
